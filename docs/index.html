<html>
  <head>
	<title>PyMetric - Documentation (Work in progress)</title>
  </head>

  <body>
	<div style="width: 800px; margin-right: auto, margin-left: auto">
	<h2>What is it?</h2>
	<p><strong>PyMetric</strong> is an interactive network simulation and
       visualisation tool. It allows the user to trace paths through
       his network, given a set of nodes and links with metrics
       (costs).
    </p>

	<p>It allows the simulation of metric changes, router failures and
       link outages, and provides various information relating to the
       changes in topology and routing. It can also consider link
       loads and how changes affect the load distribution.
	</p>

    <p>PyMetric can also show various statistics on the topology, such
       as equal-cost paths, links with asymetric costs, longest paths
       and lots more. It can even suggest some metric changes to help
       the user with traffic engineering.
	</p>
	<div style="width: 30em; clear:all; float:right; position: relative; left:
	6em;">
	<a href="path-oslo-svalbard.png"><img alt="Path from oslo-gw to
	svalbard-gw" src="path-oslo-svalbard-350px.png"></a>
	  <strong>Figure 1.</strong> Path from oslo-gw to svalbard-gw.
	</div>

	<h2>Getting started with PyMetric</h2>
	<p>This section describes some common uses of PyMetric, and should
	   help in getting started. There is a 'help'-command available,
	   which describes every command and mode in detail.
	</p>
	<h3>Running the program<small>*</small></h3>
	<p>The program should be run from the command line.:</p>
	<pre style="padding-left: 2em">$ pymetric (model) (outfile)</pre>
	<p>It can be given an optional model definition file as an
	argument. If this is not provided the default configured at
	install time will be used (if available). When given an explicit
	model to load a second filename can be given in order to produce
	a plotfile (e.g. a PNG-image). In this mode the program is not
	interactive and will terminate after writing the image file.</p>

	<h3>Basic use</h3>
	<p>The interactive shell provides command history and completion
	   of commands, options and router names.</p>	  
	<p>To view the current topology use 'plot'. To trace the path
       between two nodes use 'path A B'. Note in figure 1 how some
       links and nodes have more weight/are bigger than others. These
       have the most shortest paths passing through them, i.e. they
       are the most used in terms of connectivity.
	</p>
	<pre style="padding-left: 2em">
>>> plot
>>> path oslo-gw svalbard-gw
Path from oslo-gw to svalbard-gw:
  * Cost: 63
  * Hops: 7
  * Path:
     oslo-gw => trd-gw1 => hovedbygget-gw1 => tromso-gw1 => tromso-gw2 =>
      harstad-gw3 => svalbard-gw
  * Slowest link:  1Gbit/s

>>>
    </pre>
    <p>In order to make changes, make sure you enter simulation mode
       first. This is done with the 'simulation' (or just 'sim')
       command.
	</p>
	<pre style="padding-left: 2em">
>>> sim
Simulation mode active, type 'stop' or 'simulation stop' to end it
(sim) >>>
    </pre>
	<div style="width: 30em; clear:all; float:right; position: relative; left:
	6em;">
	<a href="diffpath-elverum-mo.png"><img alt="Difference in path
	from elverum-gw to mo-gw" src="diffpath-elverum-mo-350px.png"></a>
	<strong>Figure 2.</strong> Difference in path between elverum-gw
	and mo-gw.
	</div>
	<p>There are three kinds of basic changes you can make:</p>
	<ul><li>Metric changes, with the 'metric' command</li>
	    <li>Link failures, with the 'linkfail' command</li>
		<li>Router failures, with the 'routerfail' command</li>
	</ul>

	<p>As you make changes, the prompt will show a brief summary of
	   the effects. Type 'help simulation' to learn what the numbers
	   mean.
	</p>

    <p>When in simulation mode you can view the current topology and
       trace paths with 'simplot' and 'simpath' respectivly. You can
       view the effects of the simulation with the 'changes' command.
       If you want a graphical comparison of paths, use the 'diffpath'
       command while in simulation mode. Example:
	</p>
	<pre style="padding-left: 2em">
(sim) >>> linkfail oslo-gw trd-gw1
(sim) (1c/58:31:0n/0.16L) >>> diffpath elverum-gw mo-gw
Path from elverum-gw to mo-gw:
  * Cost: 80 vs 65
  * Hops: 8 vs 7
  * Path:
     elverum-gw => oslo-gw3 => stolav-gw1 => hovedbygget-gw1 => trd-gw1 => mo-
     gw1 => mo-gw2 => mo-gw
  * Slowest link:  1Gbit/s
    vs.
     elverum-gw => oslo-gw3 => oslo-gw => trd-gw1 => mo-gw1 => mo-gw2 => mo-gw
  * Slowest link:  1Gbit/s

(sim) (1c/58:31:0n/0.16L) >>> 
    </pre>

	<p>As seen in figure 2, the new parts are shown in light blue, the
	   old parts in yellow and the common parts are shown in a dark
	   blue color.
  <div>

	<h2>Other topics</h2>
	<p>This section will touch on some of the other stuff that you can
	   do with PyMetric, beyond the mere basics.
	</p>
	<h3>Viewing changes</h3>
	<p>The 'changes' command displays the effects of the current
	   simulation. The output can be long when there are lots of
	   effects, but by providing an optional node name, only changes
	   for that node is shown (with more detail as well). We will
	   continue the above example with link failure between oslo-gw
	   and trd-gw1.
	</p>
	<pre style="padding-left: 2em">
(sim) (1c/58:31:0n/0.16L) >>> changes
Simulated changes:
  1: Link failure between oslo-gw and trd-gw1

Effects of changes:
  * Affects 58 nodes total

  * Summary:
    bodo-gw changed path to 7 destinations

    bodo-gw2 changed path to 7 destinations

    harstad-gw changed path to 7 destinations

    harstad-gw2 changed path to 7 destinations

    harstad-gw3 changed path to 7 destinations

    hovedbygget-gw1 changed path to 7 destinations

    hovedbygget-gw4 changed path to 7 destinations

    levanger-gw changed path to 7 destinations

    mo-gw changed path to 7 destinations

    mo-gw1 changed path to 7 destinations

    mo-gw2 changed path to 7 destinations

    namsos-gw changed path to 7 destinations

    narvik-gw changed path to 7 destinations

    narvik-gw2 changed path to 7 destinations

    nesna-gw changed path to 7 destinations

    nesna-gw2 changed path to 7 destinations

    steinkjer-gw changed path to 7 destinations

    steinkjer-gw2 changed path to 7 destinations

    stjordal-gw changed path to 7 destinations

    svalbard-gw changed path to 7 destinations

    teknobyen-gw changed path to 7 destinations

    teknobyen-gw2 changed path to 7 destinations

    trd-gw1 changed path to 7 destinations

    trd-gw4 changed path to 7 destinations

    trd-gw7 changed path to 7 destinations

    tromso-gw1 changed path to 7 destinations

    tromso-gw2 changed path to 7 destinations

    tromso-gw4 changed path to 7 destinations

    tromso-gw5 changed path to 7 destinations

    tromso-gw7 changed path to 7 destinations

    tynset-gw changed path to 6 destinations

    27 sources changed path to hovedbygget-gw1

    27 sources changed path to trd-gw1

    21 sources changed path to tynset-gw

(sim) (1c/58:31:0n/0.16L) >>>
    </pre>
	<p>Now, to get more detail on the changes for tynset-gw, we could
	   do like this:
	</p>
	<pre style="padding-left: 2em">
(sim) (1c/58:31:0n/0.16L) >>> changes tynset-gw 
Simulated changes:
  1: Link failure between oslo-gw and trd-gw1

Effects of changes:
 * Details for tynset-gw 

  - Path to stolav-gw1 now via oslo-gw3
    instead of oslo-gw

  - Path to oslo-gw4 now via oslo-gw3
    instead of oslo-gw

  - Path to oslo-gw7 now via oslo-gw3
    instead of oslo-gw

  - Path to oslo-gw3 now via elverum-gw
    instead of oslo-gw

  - Path to borre-gw now via drammen-gw
    instead of sarpsborg-gw/drammen-gw

  - Path to oslo-gw now via oslo-gw3
    instead of trd-gw1

(sim) (1c/58:31:0n/0.16L) >>>
	</pre>
	<p>We are now given the path changes as seen from tynset-gw.</p>

	<h3>Getting information</h3>
	<div style="width: 30em; clear:all; float:right; position: relative; left:
	6em;">
	<a href="path-borre-oslo.png"><img alt="Equal cost paths from
	borre-gw to oslo-gw" src="path-borre-oslo-350px.png"></a>
	  <strong>Figure 3.</strong> Equal cost paths from borre-gw to oslo-gw.
	</div>

	<p>The commands that deal with getting information are:</p>
	<h4>stats</h4>
	<pre style="padding-left: 2em">
>>> stats
          center: hovedbygget-gw4, trd-gw1, hovedbygget-gw1, tromso-gw1,
                  teknobyen-gw
         density: 0.081451314328
        diameter: 9
           edges: 220
   longest paths: namsos-gw <-> lillehammer-gw (114.0), lillehammer-gw <->
                  levanger-gw (110.0), evenstad-gw <-> namsos-
                  gw (109.0), sogndal-gw <-> tynset-gw (109.0)
     mean length: 4.25420014609
           nodes: 74
       periphery: grimstad-gw2, haugesund-gw, bodo-gw, forde-gw, arendal-gw
          radius: 5
     reciprocity: 1.0
  top 20 transit: trd-gw1, hovedbygget-gw1, oslo-gw, oslo-gw3, tromso-gw1,
                  hoytek-gw, stolav-gw1, bergen-gw, alesund-
                  gw, tromso-gw2, elverum-gw, kristiansand-gw,
                  harstad-gw3, mo-gw1, volda-gw, hovedbygget-
                  gw4, mo-gw2, teknobyen-gw2, sarpsborg-gw,
                  volda-gw2

>>>
    </pre>
	<p>The 'stats' command shows various statistics about the current
	   topology. Some of the fields may need some explaining.
	</p>	
	<ul><li>'longest paths' shows the longest paths (metric-wise) in
	        the graph</li>
	    <li>'mean length' is the average distance in number of hops
	        between two nodes</li>
	    <li>'reciprocity' is the ratio of links that are
	        bidirectional.</li>
		<li>'top 20 transit' is the 20 nodes that have the most
		    shortest paths passing through them.</li>
	</ul>
	<h4>info</h4>
	<pre style="padding-left: 2em">
>>> info as-gw
Information for node as-gw:
name           : as-gw
degree         : 2
eccentricity   : 7
betweenness    : 0.000 (0.00% of max, 0.00% of avg)
neighbors      : fredrikstad-gw, oslo-gw3
links          : as-fredrikstad (15), as-oslo (20)
longest paths  : as-gw <-> tynset-gw (98.0), as-gw <-> namsos-gw (89.0), as-gw
                 <-> levanger-gw (85.0), as-gw <-> svalbard-gw
                 (84.0), as-gw <-> sogndal-gw (76.0), as-gw <->
                 bodo-gw (75.0), as-gw <-> forde-gw (75.0), as-
                 gw <-> harstad-gw (75.0)

>>>
    </pre>
	<p>The 'info' command shows various statistics for the given
	   node. A couple of fields may need explaining.
	</p>
	<ul><li>'eccentricity' is the average length in hops to another
	        node</li>
	    <li>'betweenness' is a number indicating how central the node
	        is as a transit node for shortest paths in the model.</li>
	</ul>
	<div style="width: 30em; clear:all; float:right; position: relative; left:
	6em;">
	<a href="linkloads.png"><img alt="Model with current load" src="linkloads-350px.png"></a>
	  <strong>Figure 4.</strong> Model with current load.
	</div>
	<h4>linkinfo</h4>
	<pre style="padding-left: 2em">
>>> linkinfo oslo-gw3 bergen-gw 
Information for link (oslo-gw3,bergen-gw):
name           : oslo-bergen
betweenness    : 0.007 (38.29% of max, 258.27% of avg)
capacity       : 10Gbit/s
load           : NA
utilization    : NA

>>>
    </pre>
	<p>The 'linkinfo' command is similar to the 'info' command, but
	   naturally it gives information about a given link. If link
	   loads are available current load and utilization is shown as
	   well.
	</p>
	<h4>listequal</h4>
    <pre style="padding-left: 2em">
>>> listequal
Equal-cost paths ('path source dest' for details):
  * arendal-gw      ->   oslo-gw4, oslo-gw7
  * bodo-gw         ->   oslo-gw4, oslo-gw7
  * bodo-gw2        ->   oslo-gw4, oslo-gw7
  * borre-gw        ->   kjeller-gw, oslo-gw, oslo-gw4 (3), oslo-gw7 (3)
  * drammen-gw      ->   fredrikstad-gw, halden-gw, oslo-gw4, oslo-gw7,
                         sarpsborg-gw

  ... etc ...
>>>
    </pre>
	<p>The 'listequal' command displays all equal-cost pairs,
	   i.e. paths that are load balanced. Such paths are shown in
	   figure 3. If there are more than two equal-cost paths the
	   number of paths is displayed as well.
	</p>
	<h3>Showing and simulating loads</h3>
	<div style="width: 30em; clear:all; float:right; position: relative; left:
	6em;">
	<a href="sim-linkloads.png"><img alt="Simulated model with load" src="sim-linkloads-350px.png"></a>
	  <strong>Figure 5.</strong> Simulated model with load.
	</div>
	<pre style="padding-left: 2em">
>>> linkloads
OK, loads refreshed, use 'plot with-load' to plot
>>> plot with-load
>>> 
    </pre>
	<p>Link loads can be fetched (if available) with the 'linkloads'
	   command. By default this fetches the average load over the last
	   hour. When loads are available the 'plot' and 'simplot'
	   commands take an optional 'with-load' argument. As seen in
	   figure 4, the color scheme and widths of the links change when
	   viewing load. The widths now represent the capacity of the
	   links rather than 'betweenness'. The 'linkinfo' command now
	   displays load and utilization, while a 'utilizations' command
	   shows the most utilized links.	
	</p>
	<pre style="padding-left: 2em">
>>> linkinfo oslo-gw trd-gw1 
Information for link (oslo-gw,trd-gw1):
name           : oslo-trd
betweenness    : 0.017 (98.81% of max, 666.54% of avg)
capacity       : 10Gbit/s
load           : 388.26 Mbit/s
utilization    : 3.98%

>>> utilizations 
Utilizations, type 'linkinfo source dest' for more details

Top 10:
  * oslo-gw4->oslo-gw: 19.58%
  * oslo-gw->sarpsborg-gw: 14.26%
  * sarpsborg-gw->oslo-gw: 13.12%
  * halden-gw->sarpsborg-gw: 12.02%
  * sarpsborg-gw->halden-gw: 11.35%
  * svalbard-gw->harstad-gw3: 11.00%
  * molde-gw2->alesund-gw: 8.17%
  * tromso-gw7->tromso-gw1: 5.60%
  * trd-gw1->oslo-gw: 5.38%
  * harstad-gw3->tromso-gw2: 4.56%

>>> 
    </pre>
	<p>Now, whenever we simulate a change, the most likely load
	distribution is calculated, and the new load can be seen by using
	the 'simplot with-load' command. Using a link failure between
	oslo-gw and trd-gw1 as the example as before, the effects can be
	seen in figure 5.
	</p>
	<pre style="padding-left: 2em">
(sim) >>> linkfail oslo-gw trd-gw1
(sim) (1c/58:31:0n/0:0:0u/0.16L) >>> simplot with-load
(sim) (1c/58:31:0n/0:0:0u/0.16L) >>> linkinfo stolav-gw1 hovedbygget-gw1 
Information for link (stolav-gw1,hovedbygget-gw1):
name           : oslo-trd2
betweenness    : 0.017 (100.00% of max, 651.22% of avg)
capacity       : 2.5Gbit/s
load           : 388.26 Mbit/s
utilization    : 15.98%

(sim) (1c/58:31:0n/0:0:0u/0.16L) >>> 
    </pre>
	<h3>Simulating anycast</h3>

	<hr>
	<p style="font-size: 8pt">* Note that the CVS-version currently has to be run like this: $
	./metrics.py modelfile.net, as the pymetric startup script is not
	provided. As soon as a proper release is ready this will change.</p>
  </body>
</html>
	   
